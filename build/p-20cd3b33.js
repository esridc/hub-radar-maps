import{hF as n,e5 as t,c3 as o,k0 as e,az as r,iB as s,o0 as a,U as l}from"./p-3013819f.js";import{e as c}from"./p-10315be7.js";import{a as i,m as u,c as p,l as f,h as m}from"./p-e2bfcaec.js";import{T as d,i as j,c as b,x,u as w,L as g,O as T,E as h}from"./p-7020cf1b.js";import{a as y,f as v,b as M,o as $}from"./p-53be785a.js";import{l as _,c as C,o as A,d as S,r as O,e as k,g as B,h as I,i as R,j as q,k as z,m as E,n as F}from"./p-be07fada.js";import{e as L}from"./p-6fe73432.js";import{V as N}from"./p-5dea0c0d.js";import"./p-894e6a6a.js";import{D as U}from"./p-8567e6fe.js";import"./p-3b51db5e.js";import"./p-c60ccdaa.js";import"./p-1ed893a0.js";import"./p-5bd0bced.js";import"./p-508fdb0a.js";import"./p-a276ccf5.js";import"./p-2e59108c.js";import"./p-c887d4a8.js";import"./p-1f7d3618.js";import"./p-5f148c96.js";import"./p-897991e6.js";import"./p-37592f90.js";import"./p-a111f32d.js";import"./p-22d74e36.js";import"./p-c99b552a.js";import"./p-4fb66b05.js";import"./p-c2c5c63d.js";import"./p-9b885976.js";import"./p-71ed4ac4.js";import"./p-f9d50c5f.js";function D(n,t,o){const e=n.typedBuffer,r=n.typedBufferStride,s=t.typedBuffer,a=t.typedBufferStride,l=o?o.count:t.count;let c=(o?.dstIndex??0)*r,i=(o?.srcIndex??0)*a;for(let n=0;n<l;++n){for(let n=0;n<9;++n)e[c+n]=s[i+n];c+=r,i+=a}}Object.freeze(Object.defineProperty({__proto__:null,copy:D},Symbol.toStringTag,{value:"Module"}));function G(n,t,o){const e=n.typedBuffer,r=n.typedBufferStride,s=t.typedBuffer,a=t.typedBufferStride,l=o?o.count:t.count;let c=(o?.dstIndex??0)*r,i=(o?.srcIndex??0)*a;for(let n=0;n<l;++n){for(let n=0;n<16;++n)e[c+n]=s[i+n];c+=r,i+=a}}Object.freeze(Object.defineProperty({__proto__:null,copy:G},Symbol.toStringTag,{value:"Module"}));function K(n,t){return new n(new ArrayBuffer(t*n.ElementCount*L(n.ElementType)))}async function P(n,t,o){const e=new F(Q(o)),r=(await _(e,t,o,!0)).model,s=r.lods.shift(),a=new Map,l=new Map;r.textures.forEach(((n,t)=>a.set(t,W(n)))),r.materials.forEach(((n,t)=>l.set(t,X(n,a))));const c=J(s);for(const n of c.parts)Y(c,n,l);const{position:i,normal:u,tangent:p,color:m,texCoord0:d}=c.vertexAttributes,j={position:i.typedBuffer,normal:null!=u?u.typedBuffer:null,tangent:null!=p?p.typedBuffer:null,uv:null!=d?d.typedBuffer:null,color:null!=m?m.typedBuffer:null},b=N(j,n,o);return{transform:b.transform,vertexSpace:b.vertexSpace,components:c.components,spatialReference:n.spatialReference,vertexAttributes:new f({position:b.vertexAttributes.position,normal:b.vertexAttributes.normal,tangent:b.vertexAttributes.tangent,color:j.color,uv:j.uv})}}function Q(n){const t=n?.resolveFile;return t?{busy:!1,request:async(n,o,e)=>{const r=t?.(n)??n,s="image"===o?"image":"binary"===o?"array-buffer":"json";return(await l(r,{responseType:s,signal:null!=e?e.signal:null})).data}}:null}function V(n,o){if(null==n)return"-";const e=n.typedBuffer;return`${t(o,e.buffer,(()=>o.size))}/${e.byteOffset}/${e.byteLength}`}function H(n){return null!=n?n.toString():"-"}function J(n){let o=0;const e={color:!1,tangent:!1,normal:!1,texCoord0:!1},r=new Map,s=new Map,a=[];for(const l of n.parts){const{attributes:{position:n,normal:c,color:i,tangent:u,texCoord0:p}}=l,f=`\n      ${V(n,r)}/\n      ${V(c,r)}/\n      ${V(i,r)}/\n      ${V(u,r)}/\n      ${V(p,r)}/\n      ${H(l.transform)}\n    `;let m=!1;const d=t(s,f,(()=>(m=!0,{start:o,length:n.count})));m&&(o+=n.count),c&&(e.normal=!0),i&&(e.color=!0),u&&(e.tangent=!0),p&&(e.texCoord0=!0),a.push({gltf:l,writeVertices:m,region:d})}return{vertexAttributes:{position:K(d,o),normal:e.normal?K(j,o):null,tangent:e.tangent?K(b,o):null,color:e.color?K(x,o):null,texCoord0:e.texCoord0?K(w,o):null},parts:a,components:[]}}function W(n){return new i({data:n.data,wrap:tn(n.parameters.wrap)})}function X(t,e){const r=new o(rn(t.color,t.opacity)),s=t.emissiveFactor?new o(sn(t.emissiveFactor)):null,a=t=>t?new p({scale:t.scale?[t.scale[0],t.scale[1]]:[1,1],rotation:n(t.rotation??0),offset:t.offset?[t.offset[0],t.offset[1]]:[0,0]}):null;return new u({color:r,colorTexture:e.get(t.textureColor),normalTexture:e.get(t.textureNormal),emissiveColor:s,emissiveTexture:e.get(t.textureEmissive),occlusionTexture:e.get(t.textureOcclusion),alphaMode:nn(t.alphaMode),alphaCutoff:t.alphaCutoff,doubleSided:t.doubleSided,metallic:t.metallicFactor,roughness:t.roughnessFactor,metallicRoughnessTexture:e.get(t.textureMetallicRoughness),colorTextureTransform:a(t.colorTextureTransform),normalTextureTransform:a(t.normalTextureTransform),occlusionTextureTransform:a(t.occlusionTextureTransform),emissiveTextureTransform:a(t.emissiveTextureTransform),metallicRoughnessTextureTransform:a(t.metallicRoughnessTextureTransform)})}function Y(n,t,o){t.writeVertices&&Z(n,t);const{indices:e,attributes:r,primitiveType:s,material:a}=t.gltf;let l=A(e||r.position.count,s);const c=t.region.start;if(c){const n=new Uint32Array(l);for(let t=0;t<l.length;t++)n[t]+=c;l=n}n.components.push(new m({name:t.gltf.name,faces:l,material:o.get(a),shading:r.normal?"source":"flat",trustSourceNormals:!0}))}function Z(n,t){const{position:o,normal:e,tangent:r,color:l,texCoord0:i}=n.vertexAttributes,u=t.region.start,{attributes:p,transform:f}=t.gltf,m=p.position.count;if(y(o.slice(u,m),p.position,f),null!=p.normal&&null!=e){const n=s(c(),f),t=e.slice(u,m);v(t,p.normal,n),a(n)&&M(t,t)}else null!=e&&S(e,0,0,1,{dstIndex:u,count:m});if(null!=p.tangent&&null!=r){const n=s(c(),f),t=r.slice(u,m);O(t,p.tangent,n),a(n)&&k(t,t)}else null!=r&&B(r,0,0,1,1,{dstIndex:u,count:m});if(null!=p.texCoord0&&null!=i?I(i.slice(u,m),p.texCoord0):null!=i&&R(i,0,0,{dstIndex:u,count:m}),null!=p.color&&null!=l){const n=p.color,t=l.slice(u,m);if(4===n.elementCount)n instanceof b?q(t,n,255):n instanceof x?z(t,n):n instanceof g&&q(t,n,1/256);else{B(t,255,255,255,255);const o=T.fromTypedArray(t.typedBuffer,t.typedBufferStride);n instanceof j?$(o,n,255):n instanceof T?E(o,n):n instanceof h&&$(o,n,1/256)}}else null!=l&&B(l.slice(u,m),255,255,255,255)}function nn(n){switch(n){case"OPAQUE":return"opaque";case"MASK":return"mask";case"BLEND":return"blend"}}function tn(n){return{horizontal:on(n.s),vertical:on(n.t)}}function on(n){switch(n){case U.CLAMP_TO_EDGE:return"clamp";case U.MIRRORED_REPEAT:return"mirror";case U.REPEAT:return"repeat"}}function en(n){return n**(1/C)*255}function rn(n,t){return e(en(n[0]),en(n[1]),en(n[2]),t)}function sn(n){return r(en(n[0]),en(n[1]),en(n[2]))}export{P as loadGLTFMesh};
//# sourceMappingURL=p-20cd3b33.js.map